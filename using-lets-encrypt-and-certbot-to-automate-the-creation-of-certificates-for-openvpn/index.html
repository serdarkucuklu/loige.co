<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.24.67"/><script>/**
──────────────███████──███████
──────────████▓▓▓▓▓▓████░░░░░██
────────██▓▓▓▓▓▓▓▓▓▓▓▓██░░░░░░██
──────██▓▓▓▓▓▓████████████░░░░██
────██▓▓▓▓▓▓████████████████░██
────██▓▓████░░░░░░░░░░░░██████              MAMMA MIA!
──████████░░░░░░██░░██░░██▓▓▓▓██
──██░░████░░░░░░██░░██░░██▓▓▓▓██   If you are looking here you
██░░░░██████░░░░░░░░░░░░░░██▓▓██      should definitely get
██░░░░░░██░░░░██░░░░░░░░░░██▓▓██       in touch with me on
──██░░░░░░░░░███████░░░░██████           twitter: @loige
────████░░░░░░░███████████▓▓██
──────██████░░░░░░░░░░██▓▓▓▓██
────██▓▓▓▓██████████████▓▓██
──██▓▓▓▓▓▓▓▓████░░░░░░████
████▓▓▓▓▓▓▓▓██░░░░░░░░░░██
████▓▓▓▓▓▓▓▓██░░░░░░░░░░██
██████▓▓▓▓▓▓▓▓██░░░░░░████████
──██████▓▓▓▓▓▓████████████████
────██████████████████████▓▓▓▓██
──██▓▓▓▓████████████████▓▓▓▓▓▓██
████▓▓██████████████████▓▓▓▓▓▓██
██▓▓▓▓██████████████████▓▓▓▓▓▓██
██▓▓▓▓██████████──────██▓▓▓▓████
██▓▓▓▓████──────────────██████
──████
**/</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" title="Luciano Mammino &quot;Loige&quot; - Cloud developer, entrepreneur, fighter, butterfly maker!" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=e5514a6b277bf3f1409d8b0190e93509" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#20232a"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=e5514a6b277bf3f1409d8b0190e93509"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=e5514a6b277bf3f1409d8b0190e93509"/><title data-react-helmet="true">Using Let’s Encrypt and Certbot to automate the creation of certificates for OpenVPN</title><link data-react-helmet="true" type="text/plain" rel="author" href="https://loige.co/humans.txt"/><link data-react-helmet="true" rel="canonical" content="https://loige.co/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/"/><meta data-react-helmet="true" name="description" content="This article illustrates you how to use Certbot to automate the creation of SSL certificates for OpenVPN and how to release on AWS using Terraform."/><meta data-react-helmet="true" name="image" content="https://loige.co/static/4d7bb40a4b4dcdc66fe27daa79bd36bf/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn-fb.png"/><meta data-react-helmet="true" property="og:url" content="https://loige.co/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Using Let’s Encrypt and Certbot to automate the creation of certificates for OpenVPN"/><meta data-react-helmet="true" property="og:description" content="This article illustrates you how to use Certbot to automate the creation of SSL certificates for OpenVPN and how to release on AWS using Terraform."/><meta data-react-helmet="true" property="og:image" content="https://loige.co/static/4d7bb40a4b4dcdc66fe27daa79bd36bf/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn-fb.png"/><meta data-react-helmet="true" property="fb:app_id" content="231187154413670"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="loige"/><meta data-react-helmet="true" name="twitter:title" content="Using Let’s Encrypt and Certbot to automate the creation of certificates for OpenVPN"/><meta data-react-helmet="true" name="twitter:description" content="This article illustrates you how to use Certbot to automate the creation of SSL certificates for OpenVPN and how to release on AWS using Terraform."/><meta data-react-helmet="true" name="twitter:image" content="https://loige.co/static/f425f3fa6df54e1bf300a94fcdd1bf4c/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn-tw.png"/><script data-react-helmet="true" type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","url":"https://loige.co/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/","name":"Using Let’s Encrypt and Certbot to automate the creation of certificates for OpenVPN","alternateName":"Luciano Mammino \"Loige\" - Cloud developer, entrepreneur, fighter, butterfly maker!"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://loige.co/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/","name":"Using Let’s Encrypt and Certbot to automate the creation of certificates for OpenVPN","image":"https://loige.co/static/4d7bb40a4b4dcdc66fe27daa79bd36bf/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn-fb.png"}}]},{"@context":"http://schema.org","@type":"BlogPosting","url":"https://loige.co/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/","name":"Using Let’s Encrypt and Certbot to automate the creation of certificates for OpenVPN","alternateName":"Luciano Mammino \"Loige\" - Cloud developer, entrepreneur, fighter, butterfly maker!","headline":"Using Let’s Encrypt and Certbot to automate the creation of certificates for OpenVPN","image":{"@type":"ImageObject","url":"https://loige.co/static/4d7bb40a4b4dcdc66fe27daa79bd36bf/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn-fb.png"},"description":"This article illustrates you how to use Certbot to automate the creation of SSL certificates for OpenVPN and how to release on AWS using Terraform.","author":{"@type":"Person","name":"Luciano Mammino"},"publisher":{"@type":"Organization","url":"https://loige.co/","name":"Luciano Mammino","logo":{"@context":"http://schema.org","itemtype":"https://schema.org/ImageObject","url":"https://loige.co/favicon.ico"}},"mainEntityOfPage":{"@type":"WebSite","@id":"https://loige.co/"},"datePublished":"2017-06-19T22:00:20.000Z"}]</script><link as="script" rel="preload" href="/webpack-runtime-9add3bd124e56b1a6ff9.js"/><link as="script" rel="preload" href="/framework-81279cacaab4bdba7685.js"/><link as="script" rel="preload" href="/app-fd3bb3cd76573cd1684d.js"/><link as="script" rel="preload" href="/850935577dc6138b95e5bc3f6f1d9b06bd36398e-76830da6586781bb274a.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-78dda0257c60046d6431.js"/><link as="fetch" rel="preload" href="/page-data/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><style data-emotion-css="1l52y5h">*{box-sizing:border-box;margin:0;padding:0;}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-style:normal;font-weight:400;fill:currentColor;}@media (min-width:780px){body{margin:60px 0 0 0;}}code,pre{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace;font-weight:300;}.content a{-webkit-text-decoration:none;text-decoration:none;}blockquote .gatsby-highlight{margin:1.5em 0 1.5em 0;padding:0.5em;}.gatsby-highlight{font-size:15px;line-height:1.7;background:#282c34;color:#ffffff;border-radius:10px;overflow:auto;tab-size:1.5em;margin:1.5em -1em 1.5em 0;padding:1em;}@media (min-width:780px){.gatsby-highlight{margin-left:-2em;padding-left:2em;padding-right:2em;font-size:16px;}}.gatsby-highlight .token.attr-name{color:#c5a5c5;}.gatsby-highlight .token.comment,.gatsby-highlight .token.block-comment,.gatsby-highlight .token.prolog,.gatsby-highlight .token.doctype,.gatsby-highlight .token.cdata{color:#999999;}.gatsby-highlight .token.property,.gatsby-highlight .token.number,.gatsby-highlight .token.function-name,.gatsby-highlight .token.constant,.gatsby-highlight .token.symbol,.gatsby-highlight .token.deleted{color:#5a9bcf;}.gatsby-highlight .token.boolean{color:#ff8b50;}.gatsby-highlight .token.tag{color:#fc929e;}.gatsby-highlight .token.string{color:#8dc891;}.gatsby-highlight .token.punctuation{color:#5FB3B3;}.gatsby-highlight .token.selector,.gatsby-highlight .token.char,.gatsby-highlight .token.builtin,.gatsby-highlight .token.inserted{color:#D8DEE9;}.gatsby-highlight .token.function{color:#79b6f2;}.gatsby-highlight .token.operator,.gatsby-highlight .token.entity,.gatsby-highlight .token.url,.gatsby-highlight .token.variable{color:#d7deea;}.gatsby-highlight .token.attr-value{color:#8dc891;}.gatsby-highlight .token.keyword{color:#c5a5c5;}.gatsby-highlight .token.atrule,.gatsby-highlight .token.class-name{color:#FAC863;}.gatsby-highlight .token.important{font-weight:400;}.gatsby-highlight .token.bold{font-weight:700;}.gatsby-highlight .token.italic{font-style:italic;}.gatsby-highlight .token.entity{cursor:help;}.gatsby-highlight > pre{height:auto !important;margin:1rem;white-space:pre-wrap;word-break:break-word;}.gatsby-highlight + .gatsby-highlight{margin-top:20px,;}.gatsby-highlight-code-line{background-color:#14161a;display:block;margin:-0.125rem calc(-1rem - 15px);padding:0.125rem calc(1rem + 15px);}</style><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="4ny1py qihpir 11o9ira qihpir 11o9ira qihpir 11o9ira">.css-4ny1py{display:none;}@media (min-width:540px){.css-4ny1py{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-qihpir{color:#fff;-webkit-text-decoration:none;text-decoration:none;text-align:center;padding:5px 4px;white-space:nowrap;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:background 150ms;transition:background 150ms;}.css-qihpir:hover{background:rgba(255,255,255,0.2);}.css-qihpir span{display:none;}@media (min-width:780px){.css-qihpir{padding:5px 10px;}}@media (min-width:1180px){.css-qihpir{width:60%;}.css-qihpir span{display:inline-block;}.css-qihpir img{margin-right:1em;}}.css-11o9ira{width:16px;height:16px;color:#fff;fill:currentColor;}@media (min-width:540px){.css-11o9ira{width:24px;height:24px;}}@media (min-width:1180px){.css-11o9ira{margin:0 0.5em 0 0;}}</style><style data-emotion-css="18phon9">.css-18phon9{background-color:rgba(32,35,42,0.95);color:#ffffff;display:block;position:auto;z-index:2000;width:100%;top:0;left:0;}@media (min-width:780px){.css-18phon9{position:fixed;}}</style><header class="css-18phon9 ejhzk940"><style data-emotion-css="150r9ci">.css-150r9ci{padding-left:4px;padding-right:4px;margin-left:auto;margin-right:auto;max-width:1260px;}@media (min-width:780px){.css-150r9ci{width:90%;padding-left:20px;padding-right:20px;}}</style><div class="css-150r9ci ejhzk941"><style data-emotion-css="a26ruv">.css-a26ruv{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:60px;}</style><div class="css-a26ruv ejhzk942"><style data-emotion-css="1cncqt3 1hp6i1l 1v6ch8x">.css-1cncqt3{color:#46c9e5;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-right:10px;height:100%;-webkit-text-decoration:none;text-decoration:none;-webkit-flex-direction:center;-ms-flex-direction:center;flex-direction:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:none;}@media (min-width:600px){.css-1cncqt3{width:calc(100% / 6);}}@media (min-width:540px){.css-1cncqt3{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.css-1hp6i1l{display:inline-block;vertical-align:top;}.css-1v6ch8x{margin-left:10px;font-weight:bold;font-size:20px;line-height:20px;}</style><a class="css-1cncqt3" href="/"><img class="css-1hp6i1l" height="60px" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjExNjMuMTI2IiB2aWV3Qm94PSIwIDAgMTI4NS41NjMgMTE2My4xMjYiIHdpZHRoPSIxMjg1LjU2MyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGNsaXBQYXRoIGlkPSJhIj48cGF0aCBkPSJtMCAwaDEyODUuNTYzdjExNjMuMTI2aC0xMjg1LjU2M3oiLz48L2NsaXBQYXRoPjxnIGNsaXAtcGF0aD0idXJsKCNhKSI+PHBhdGggZD0ibTExNjMuMTMxIDU1MC45NTV2NjEuMjE2aC02MS4yMTd2MjQ0Ljg2OWg2MS4yMTcgNjEuMjE2di0zMDYuMDg1eiIgZmlsbD0iIzc0NGUyNiIvPjxwYXRoIGQ9Im01NTAuOTU1IDc5NS44MjRoLTEyMi40Mzd2NjEuMjE2aC02MS4yMTZ2MTIyLjQzN2gxMjIuNDM3di02MS4yMTZoNjEuMjE2eiIgZmlsbD0iIzc0NGUyNiIvPjxwYXRoIGQ9Im05MTguMjYxIDYxMi4xNzFoLTYxLjIxNnYtNjEuMjE2aDYxLjIxNnptNjEuMjE3IDBoLTYxLjIxN3Y2MS4yMTZoNjEuMjE3em0xMjIuNDMyIDYxLjIxNnYxODMuNjUzaC0xMjIuNDMyLTEyMi40Mzd2NjEuMjE3aC0xMjIuNDMzLTE4My42NTN2LTE4My42NDloMTIyLjQzN3YtMTIyLjQzN2g2MS4yMTZ2NjEuMjE2aDE4My42NTN2NjEuMjIxaDYxLjIxN3YtNjEuMjIxem0tMzA2LjA4NiA2MS4yMjFoLTYxLjIxNnY2MS4yMTZoNjEuMjE2em0tMTgzLjY0OC0xMjIuNDM3aDYxLjIxNnYtNjEuMjE2aC02MS4yMTZ6IiBmaWxsPSIjNGVjMmM4Ii8+PHBhdGggZD0ibTkxOC4yNjEgMTIyLjQzMnYtNjEuMjE2aC00MjguNTE4djYxLjIxNmgtNjEuMjIxdjM2Ny4zMDJoMTIyLjQzN3YtNjEuMjE2aC02MS4yMTZ2LTEyMi40MzNoNjEuMjE2djEyMi40MzNoNjEuMjE3di0xMjIuNDMzaDEyMi40MzJ2LTEyMi40MzZoMTgzLjY1M3Y2MS4yMmg2MS4yMTd2LTEyMi40Mzd6IiBmaWxsPSIjNzQ0ZTI2Ii8+PHBhdGggZD0ibTk3OS40NzggMTIyLjQzNmg2MS4yMTZ2NjEuMjE3aC02MS4yMTZ6IiBmaWxsPSIjMmEyYTJhIi8+PHBhdGggZD0ibTYxMi4xNzEgNjEyLjE3MWg2MS4yMTd2MTIyLjQzN2gtMTgzLjY0OXYtNjEuMjE3aC0xMjIuNDM3di0xMjIuNDM2aDI0NC44Njl6bTM2Ny4zMDcgNjEuMjJoLTYxLjIxN3Y2MS4yMTdoNjEuMjE3em0tMjQ0Ljg3NCAxMjIuNDMzaDYxLjIxNnYtNjEuMjE2aC02MS4yMTZ6bTI0NC44NzQtNjEyLjE3MXY2MS4yMTZoNjEuMjE2djEyMi40MzNoLTYxLjIxNnYxODMuNjUzaC02MS4yMjF2NjEuMjE2aDEyMi40Mzd2LTYxLjIxNmg2MS4yMTZ2LTYxLjIxN2g2MS4yMTZ2LTYxLjIyLTEyMi40MzMtMTIyLjQzMnptLTEyMi40MzcgMzY3LjMwMmgtMTgzLjY1M3Y2MS4yMTZoNjEuMjE2djYxLjIyaDE4My42NTN2LTYxLjIyaC02MS4yMTZ6IiBmaWxsPSIjZmJkODAwIi8+PHBhdGggZD0ibTEyMjQuMzQ3IDQ4OS43MzR2LTQ4OS43MzRoLTYxLjIxNi03MzQuNjA5djYxLjIxNmgtNjEuMjE2djQyOC41MThoLTE4My42NTN2NjEuMjIxaC02MS4yMnYxODMuNjQ5aDI0NC44NzN2NjEuMjJoLTEyMi40Mzd2NjEuMjE2aC02MS4yMTZ2NjEuMjE3aDYxLjIxNnY2MS4yMmg2MS4yMTd2NjEuMjE2aDEyMi40MzZ2NjEuMjE3aDYxLjIxN3YtNjEuMjE3aDYxLjIxNnYtNjEuMjE2aDQyOC41MjN2LTYxLjIyaDMwNi4wODV2LTQyOC41MjN6bTAgMzY3LjMwNmgtMzY3LjMwNnY2MS4yMTdoLTM2Ny4zMDJ2NjEuMjJoLTEyMi40MzN2LTEyMi40MzdoNjEuMjE2di02MS4yMTZoMTIyLjQzM3YtNjEuMjJoLTYxLjIxNnYtNjEuMjE3aC0zMDYuMDg2di02MS4yMTZoNjEuMjE2di02MS4yMTZoMTIyLjQzNyAxODMuNjQ5di02MS4yMjFoLTEyMi40MzN2LTE4My42NDktMTgzLjY1M2g2MS4yMTd2LTYxLjIxNmg0MjguNTIydjYxLjIxNmg2MS4yMTd2LTYxLjIxNmgxODMuNjUzdjQyOC41MThoLTYxLjIyMXY2MS4yMjFoLTYxLjIxNnY2MS4yMTZoLTYxLjIxNnY2MS4yMTZoMTIyLjQzMnYtNjEuMjE2aDYxLjIyMXYtNjEuMjE2aDYxLjIxNnoiIGZpbGw9IiMyYTJhMmEiLz48cGF0aCBkPSJtODU3LjA0MSAzMDYuMDg1aC02MS4yMTd2LTYxLjIxNmg2MS4yMTd6bS02NzMuMzg4IDYxMi4xNzJoLTYxLjIxNnY2MS4yMTZoNjEuMjE2em0xODMuNjUzIDI0NC44NjloNjEuMjE2di02MS4yMTZoLTYxLjIxNnptLTE4My42NTMtNjEuMjE2aDYxLjIxNnYtNjEuMjE3aC02MS4yMTZ6bS0xODMuNjUzIDBoNjEuMjE2di02MS4yMTdoLTYxLjIxNnptOTc5LjQ3OC02NzMuMzkydi02MS4yMTZoLTE4My42NTR2NjEuMjE2aC02MS4yMTZ2MTIyLjQzN2gxMjIuNDMzIDEyMi40Mzd2LTYxLjIyMWgtMTIyLjQzN3YtNjEuMjE2eiIgZmlsbD0iIzJhMmEyYSIvPjxnIGZpbGw9IiNmZmYiPjxwYXRoIGQ9Im03OTUuODI0IDI0NC44NjloMTIyLjQzNnYtNjEuMjE2aC0xMjIuNDM2LTYxLjIxNnYxMjIuNDMyaDYxLjIxNnptNjEuMjE3IDYxLjIxNmgtNjEuMjE3djYxLjIxN2gyNDQuODcydi02MS4yMTdoLS4wMDJ2LTYxLjIxNmgtMTgzLjY1M3ptLTMwNi4wODYgMTIyLjQzM2gxODMuNjUzdjEyMi40MzdoLTE4My42NTN6bS02MS4yMTYtMTIyLjQzM2g2MS4yMTZ2MTIyLjQzM2gtNjEuMjE2em0xMjIuNDM3IDBoMTgzLjY0OHYxMjIuNDMzaC0xODMuNjQ4em0yNDQuODY1IDEyMi40MzNoMTIyLjQzN3Y2MS4yMTZoLTEyMi40Mzd6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48cGF0aCBkPSJtMjQ0Ljg2OSA2NzMuMzkxaDEyMi40MzN2LTEyMi40MzZoLTEyMi40MzN2NjEuMjE4aC02MS4yMTZ2NjEuMjE4eiIvPjxwYXRoIGQ9Im0xMTYzLjEyNiAxMjIuNDM2aC4wMDV2LTYxLjIyaC0xODMuNjUzdjYxLjIyaDYxLjIxOHY2MS4yMTdoMTIyLjQzeiIvPjwvZz48L2c+PC9zdmc+" alt="Loige"/><span class="css-1v6ch8x">Loige</span></a><style data-emotion-css="4z8n6j">.css-4z8n6j{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;height:100%;width:70%;}@media (min-width:1180px){.css-4z8n6j{width:60%;}}</style><nav class="css-4z8n6j ejhzk943"><style data-emotion-css="19dzbnu 1nr7fp2">.css-19dzbnu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#ffffff;-webkit-transition:color 0.2s ease-out;transition:color 0.2s ease-out;padding-left:15px;padding-right:15px;font-weight:300;-webkit-text-decoration:none;text-decoration:none;}@media (min-width:1280px){.css-19dzbnu{padding-left:20px;padding-right:20px;font-size:18px;}}.css-1nr7fp2{color:#46c9e5;position:relative;}</style><a class="css-19dzbnu css-1nr7fp2" href="/"><style data-emotion-css="jx0hn6">.css-jx0hn6{position:absolute;bottom:-1px;height:4px;left:0px;right:0px;z-index:1;background:#46c9e5;}</style><span class="css-jx0hn6 e5yudoc0"></span>Blog</a><a class="css-19dzbnu" href="/speaking">Speaking</a><a class="css-19dzbnu" href="/about">About</a></nav><style data-emotion-css="2lxe0m">.css-2lxe0m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;height:100%;width:30%;}@media (min-width:1180px){.css-2lxe0m{width:40%;}}</style><div class="css-2lxe0m ejhzk944"><a rel="nofollow" class="css-qihpir" href="https://github.com/lmammino"><svg aria-label="GitHub" viewBox="0 0 24 24" width="1em" height="1em" class="css-11o9ira" alt="Luciano&#x27;s GitHub profile"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span>GitHub</span></a><a rel="nofollow" class="css-qihpir" href="https://twitter.com/loige"><svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em" class="css-11o9ira" alt="Luciano&#x27;s Twitter profile"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg><span>Twitter</span></a><a rel="nofollow" class="css-qihpir" href="https://www.linkedin.com/in/lucianomammino/"><svg aria-label="LinkedIn" viewBox="0 0 24 24" width="1em" height="1em" class="css-11o9ira" alt="Luciano&#x27;s LinkedIn profile"><path fill="currentColor" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg><span>LinkedIn</span></a></div></div></div><style data-emotion-css="1w1zzcb">.css-1w1zzcb{height:2px;display:block;-webkit-transform-origin:left center 0px;-ms-transform-origin:left center 0px;transform-origin:left center 0px;-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);z-index:50;-webkit-transition:-webkit-transform 400ms ease 100ms;-webkit-transition:transform 400ms ease 100ms;transition:transform 400ms ease 100ms;background:linear-gradient(90deg,#46c9e5,#d26ac2);}</style><span class="css-1w1zzcb ejhzk945"></span></header><style data-emotion-css="vvgs1u">.css-vvgs1u{background-color:#46c9e5;background-repeat:no-repeat;background-position:center;background-size:cover;width:100%;min-height:300px;height:50vh;display:table;}.css-vvgs1u.small{max-height:300px;}.css-vvgs1u.tiledBg{background-size:auto;background-repeat:repeat;}.css-vvgs1u.bottomRightBg{background-position:bottom right;}.css-vvgs1u.gradientOverlay{position:relative;z-index:-2;}.css-vvgs1u.gradientOverlay:before{content:'';position:absolute;top:0;right:0;bottom:0;left:0;background-image:linear-gradient(to bottom right,#46c9e5,#d26ac2);opacity:0.6;z-index:-1;}@media (min-width:780px){.css-vvgs1u{height:70vh;}}</style><div class="textOverlay css-vvgs1u ea1ziiz0" style="background-image:url(/static/45dfcbcf12ab7cac8a20f867207af385/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn-loige-icover-image.jpg)"><style data-emotion-css="1dbbfk8">.css-1dbbfk8{display:table-cell;vertical-align:middle;text-align:center;font-weight:700;color:#fff;padding:0 2em;color:white;text-shadow:1px 3px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;}@media (min-width:780px){.css-1dbbfk8{font-size:1.2em;}}.css-1dbbfk8 h1{font-size:2em;line-height:1.6em;}.css-1dbbfk8 h2{font-size:1.5em;margin:0.5em 0 0 0;line-height:1.6em;}.css-1dbbfk8.textOverlay > * > span{background:#000000c4;display:inline;padding:0.2em;-webkit-box-decoration-break:clone;box-decoration-break:clone;-webkit-box-decoration-break:clone;}</style><div class="textOverlay css-1dbbfk8 ea1ziiz1"><h1><span>Using Let’s Encrypt and Certbot to automate the creation of certificates for OpenVPN</span></h1></div></div><style data-emotion-css="dpbxro">.css-dpbxro{min-height:100vh;margin:0 auto;padding-left:20px;padding-right:20px;max-width:1260px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media (min-width:780px){.css-dpbxro{width:90%;}}</style><div class="css-dpbxro e1kc7zwr0"><style data-emotion-css="i3jcei">.css-i3jcei{-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><section class="css-i3jcei e1kc7zwr1"><style data-emotion-css="11d495d">.css-11d495d{-webkit-flex:1;-ms-flex:1;flex:1;}@media (min-width:780px){.css-11d495d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="css-11d495d e1kc7zwr2"><style data-emotion-css="19yjhy2">.css-19yjhy2{-webkit-flex:3;-ms-flex:3;flex:3;width:100%;}</style><main class="css-19yjhy2 e1kc7zwr3"><style data-emotion-css="1qj4z9r">.css-1qj4z9r{margin:2em 0;line-height:25px;padding:0 1em;}.css-1qj4z9r a{-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-1qj4z9r a:hover{-webkit-text-decoration:underline;text-decoration:underline;}@media (min-width:780px){.css-1qj4z9r{padding:0 2em;}}</style><div class="css-1qj4z9r ep8980s0"><style data-emotion-css="0 1yorln6">.css-1yorln6{margin:0 0.25em 0 0;}</style><style data-emotion-css="ijcij0">.css-ijcij0{vertical-align:middle;font-size:inherit;margin:0 0.5em;display:inline-block;}.css-ijcij0 span{vertical-align:text-bottom;}</style><span style="margin-left:0" class="css-ijcij0 e1r90wi10"><svg aria-hidden="true" data-prefix="far" data-icon="calendar-alt" class="css-1yorln6" viewBox="0 0 448 512" width="1em" height="1em"><path fill="currentColor" d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"></path></svg><span>June 19, 2017</span></span><style data-emotion-css="j1wil6">.css-j1wil6{vertical-align:middle;margin:0 0.5em 0 1em;display:inline-block;}.css-j1wil6 a{color:inherit;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;vertical-align:text-bottom;}</style><span class="css-j1wil6 ex82wp60"><svg aria-hidden="true" data-prefix="fas" data-icon="tags" class="css-1yorln6" viewBox="0 0 640 512" width="1em" height="1em"><path fill="currentColor" d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg><a href="/tag/ssl">#<!-- -->ssl</a><style data-emotion-css="i6dzq1">.css-i6dzq1{vertical-align:text-bottom;}</style><span class="css-i6dzq1 ex82wp61">, </span><a href="/tag/web">#<!-- -->web</a><span class="css-i6dzq1 ex82wp61">, </span><a href="/tag/terraform">#<!-- -->terraform</a><span class="css-i6dzq1 ex82wp61">, </span><a href="/tag/security">#<!-- -->security</a><span class="css-i6dzq1 ex82wp61">, </span><a href="/tag/aws">#<!-- -->aws</a></span><a href="#comments" title="Read comments"><svg aria-hidden="true" data-prefix="fas" data-icon="comments" class="svg-inline--fa fa-comments fa-w-18" viewBox="0 0 576 512" width="1em" height="1em" style="margin:0 .25em 0 1em"><path fill="currentColor" d="M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"></path></svg><span class="disqus-comment-count" data-disqus-identifier="using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn" data-disqus-url="https://loige.co/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn">comments</span></a><p>— Published by<!-- --> <style data-emotion-css="ovd4d3">.css-ovd4d3{background:transparent !important;white-space:nowrap !important;color:#000 !important;}.css-ovd4d3:hover{-webkit-text-decoration:underline !important;text-decoration:underline !important;}</style><a href="https://twitter.com/loige" rel="nofollow noopener noreferrer" target="_blank" class="css-ovd4d3 e1ondplw0"><style data-emotion-css="13t2sz">.css-13t2sz{border-radius:50%;width:2em;height:2em;vertical-align:middle;display:inline-block;margin:0 .5em 0 0;overflow:hidden;}</style><img alt="Luciano Mammino&#x27;s profile picture" src="https://unavatar.now.sh/twitter/loige" class="css-13t2sz e1ondplw1"/>Luciano Mammino</a></p></div><style data-emotion-css="v7r8zh">.css-v7r8zh{margin:2em 0;line-height:25px;padding:0 1em;}.css-v7r8zh code{white-space:pre-wrap;word-break:break-word;}@media (min-width:780px){.css-v7r8zh{padding:0 2em;}}.css-v7r8zh a{background-color:rgba(187,239,253,0.3);border-bottom:1px solid rgba(0,0,0,0.2);-webkit-text-decoration:none;text-decoration:none;color:inherit;}.css-v7r8zh a:hover{background-color:#bbeffd;border-bottom-color:#1a1a1a;}.css-v7r8zh a.anchor,.css-v7r8zh a.gatsby-resp-image-link{background-color:transparent;border:none;}.css-v7r8zh a.anchor.before{position:absolute;top:64px;left:-1em;}.css-v7r8zh > p:first-of-type{font-size:18px;font-weight:300;color:#6d6d6d;}.css-v7r8zh > p:first-of-type a,.css-v7r8zh > p:first-of-type strong{font-weight:400;}@media (min-width:780px){.css-v7r8zh > p:first-of-type{font-size:24px;}}.css-v7r8zh p{margin:1em 0 0 0;font-size:16px;line-height:1.7;max-width:42em;}@media (min-width:780px){.css-v7r8zh p{font-size:17px;line-height:1.7;}}.css-v7r8zh h2,.css-v7r8zh h3,.css-v7r8zh h4,.css-v7r8zh h5{margin:2em 0 0 0;}.css-v7r8zh p > code,.css-v7r8zh li > code{background:rgba(255,229,100,0.2);color:inherit;display:inline-block;padding:0 0.3em;}.css-v7r8zh p > code,.css-v7r8zh li > code,.css-v7r8zh p > a > code,.css-v7r8zh li > a > code{padding:0 3px;font-size:inherit;word-break:break-word;}.css-v7r8zh h2{border-top:1px solid #ececec;margin-top:2em;padding-top:2em;line-height:1.2;font-size:20px;}.css-v7r8zh h2:first-of-type{border-top:0;padding-top:0;}@media (min-width:780px){.css-v7r8zh h2{font-size:35px;}}.css-v7r8zh hr + h2{border-top:0;margin-top:0;}.css-v7r8zh h3{padding-top:45px;font-size:18px;}@media (min-width:780px){.css-v7r8zh h3{font-size:25px;line-height:1.3;}}.css-v7r8zh h2 + h3,.css-v7r8zh h2 + h3:first-of-type{padding-top:30px;}.css-v7r8zh h4{font-size:20px;color:#6d6d6d;line-height:1.3;margin-top:50px;font-weight:400;}.css-v7r8zh h4 + p{margin-top:20px;}.css-v7r8zh ol,.css-v7r8zh ul{margin-top:20px;font-size:16px;padding-left:2em;}.css-v7r8zh ol p,.css-v7r8zh ul p,.css-v7r8zh ol p:first-of-type,.css-v7r8zh ul p:first-of-type{font-size:16px;margin-top:0;line-height:1.2;}.css-v7r8zh ol li,.css-v7r8zh ul li{margin-top:10px;}.css-v7r8zh ol ol,.css-v7r8zh ul ol,.css-v7r8zh ol ul,.css-v7r8zh ul ul{margin-left:20px;margin-top:10px;}.css-v7r8zh img{max-width:100%;}.css-v7r8zh ol{list-style:decimal;}.css-v7r8zh ul{list-style:disc;}.css-v7r8zh blockquote{background-color:rgba(255,229,100,0.3);border-left-color:#ffe564;border-left-width:9px;border-left-style:solid;padding:20px 45px 20px 26px;margin:1em 0 2em -1em;}@media (min-width:780px){.css-v7r8zh blockquote{margin-left:-2em;}}.css-v7r8zh blockquote p{margin-top:15px;}.css-v7r8zh blockquote p:first-of-type{font-weight:700;margin-top:0;}.css-v7r8zh blockquote p:nth-of-type(2){margin-top:0;}.css-v7r8zh table{margin:1em auto;border-spacing:0;border-collapse:collapse;width:100%;}@media (min-width:780px){.css-v7r8zh table{width:80%;}}.css-v7r8zh table td,.css-v7r8zh table th{border:1px solid #ccc;margin:0;padding:0.4em;}.css-v7r8zh table + legend{border-left:3px solid #ccc;font-size:small;font-style:italic;width:100%;margin:1em auto;padding:0 0 0 1em;}@media (min-width:780px){.css-v7r8zh table + legend{width:80%;}}</style><article class="css-v7r8zh e1lcgljk0"><p>Recently at <a href="https://planet9energy.com">Planet 9 Energy</a>, I had to setup a VPN access to secure some of our internal services. One of the requirements was to make the provisioning easy to reproduce over multiple environments, so we ended up playing a bit with Terraform, while obviously adopting OpenVPN for the VPN server.</p>
<p>Another important requirement was to expose the OpenVPN web interface (also called Access Server) using an SSL, which I was expecting to be one of the most challenging things to automate, instead, it turned out to be very easy using <a href="https://letsencrypt.org">Let’s Encrypt</a> and <a href="https://certbot.eff.org">Certbot</a>.</p>
<p>In this article, I will illustrate you how to use Certbot to automate the creation of SSL certificates (for OpenVPN as a practical example) and how to integrate this process in AWS-land using Terraform.</p>
<h2 id="installing-certbot" style="position:relative;"><a href="#installing-certbot" aria-label="installing certbot permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installing Certbot</h2>
<p>Installing Certbot on a Ubuntu (Xenial) machine is as easy as:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> -y <span class="token function">install</span> software-properties-common
<span class="token function">sudo</span> add-apt-repository -y ppa:certbot/certbot
<span class="token function">sudo</span> <span class="token function">apt-get</span> -y update
<span class="token function">sudo</span> <span class="token function">apt-get</span> -y <span class="token function">install</span> certbot</code></pre></div>
<p>This code uses the <code>certbot</code> PPA to install the executable.</p>
<p>A Little tip (in case you don’t know it yet): <code>-y</code> allows the install to be non-interactive and to proceed without the need to confirm every operation from the keyboard.</p>
<p>From this moment on you can use the <code>certbot</code> executable.</p>
<p>If you want to have an idea of its capabilities you can simply run:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">certbot --help</code></pre></div>
<p>The outcome will be something like this:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 575px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 132.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAAsSAAALEgHS3X78AAADvklEQVQ4y32UCXeqSBCFFUURV1DZEZEdIYqap+Zkck7ezP//TfOx5GW2MxXSQkN337p1b/UcxwnDaEd4O3fnGoZhWdZytTRNs/ev6Dfx/TydzviaNUEQZFnmuq5lM2ErirLzvIN/4GZPeN5oJP5zM1VVdV1fLBaGYWpbTVmt1uv1YrHcbremaRm6MZvNLNvWNV0aj+fzOd+PRqNu8el0zrPsx/3+eDxemnh//+35fJZleblciqK4Xq/H45HHIAz5+HK9+ge/w65p+nQ2dZw6W9txSDVJkmOeG4ZuWib4NU0TiH5fENrf/mAw6DJ33J1lmZ7nue5OXW/I2WADw/T2vmUa/YYkvh4Oh4ySNOb65mw8HreYOYFsP3//4/TyAsj7457nJJTmxyI/Hmv8t9ulqqgOGwGhW5/l+eFw6Pf6Q1E8nU5BE6yMkzSKoqq6kAjlPJ3PdUG9HR+TY71SFEXbdqIwhHAwed7+4PvebmfbdcXg3Nt7a1VdKiugUQVN11erVXfycrmiijBJtixgMZfThO/7WZZTZ2EgzOeLqTwlhL+KZLPZPt/ePj4+wAaq2+1GtrfXH9SJ+ff3d4SHENAfF/qh1NKEkCGrJ01kvuNwNmKOxKIoBAjJpVmaJCmvwiiM4hgWgJZmWXW5wORysegJgwE51Nv0eoIwaDlnbBRmQoQojigUB9ag5SkH8DuZSDVsSZpQ4c1mg/qoAXqK60OOSI1RN/StprmOy17rtdq6ozVIzRlswxDEthoCJLLy/b2qKIAELVuzUdQEdQEOuAzT0rabXhBE8AxVhyBwXac1XSsD4cuAv0YsITXRvuzJslwWZZZnlH4xnzeERUEQnquqFnlxxKcYPY4TZAftnEwVO2OxQXW57nZuK5jH45mmaRzXekJtesMcB0AKaBH43/zMFEyiLUVR+aM31KTKcj05Gvf+P0zL/vz8iYGRq6oqj+fb+VwVRfm4319fX+MkTpOUvA4HX57Iq9WyK1LXlgSB6iMLoS8A+/RyQiG4PwyDJE1bnquqwl5l+YL+SOobvKqujTrM5XJJx4HJVgbiUEQ53EiNiUd1jPnnLcb+0nZT/bqN2A5k/mdqg6+gOm0/6V6wmSxPKACqZIuJJMVJUjRBzmVR4C1SQEWIQVFWnNGZudEz6h4wApKRvagNVmv4U2mgpAPUrnsNB0Nx+N2GMCoyQNJVdUYnl0vdK2EFnmqfBweUBwoemcTsjKDrFs9m8/v9XtClyvJ8PqOqoizaxZv1Zjad0QwoO/biBldhwV/d4E+4ZIpFx5dpGQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/ecf9876f6711e42e12ccca556603cdd5/8d3d1/certbot-help-output-ubuntu.webp 256w,
/static/ecf9876f6711e42e12ccca556603cdd5/354cf/certbot-help-output-ubuntu.webp 512w,
/static/ecf9876f6711e42e12ccca556603cdd5/4410d/certbot-help-output-ubuntu.webp 575w"
          sizes="(max-width: 575px) 100vw, 575px"
          type="image/webp"
        />
        <source
          srcset="/static/ecf9876f6711e42e12ccca556603cdd5/85b06/certbot-help-output-ubuntu.png 256w,
/static/ecf9876f6711e42e12ccca556603cdd5/bc282/certbot-help-output-ubuntu.png 512w,
/static/ecf9876f6711e42e12ccca556603cdd5/facd4/certbot-help-output-ubuntu.png 575w"
          sizes="(max-width: 575px) 100vw, 575px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/ecf9876f6711e42e12ccca556603cdd5/facd4/certbot-help-output-ubuntu.png"
          alt="Certbot help output"
          title="Certbot help output"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
    </span></p>
<h2 id="generating-a-certificate-with-certbot" style="position:relative;"><a href="#generating-a-certificate-with-certbot" aria-label="generating a certificate with certbot permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating a certificate with Certbot</h2>
<p>Certbot uses Let’s Encrypt to generate a certificate. Let’s encrypt issues a certificate for your domain only if able to verify that you really own that domain and that it is associated with the public IP of the machine from which you are running certbot.</p>
<p>So, in order to pass the verification process, you need to have a web server running on your machine and accessible from the outside world. While Certbot supports the main web servers such as <a href="/tag/nginx/">Nginx</a> and Apache, it also features a standalone server that you can use exclusively for the verification process. This web server will run on the standard web ports (80 and 443), so if you have other services using these ports you need to stop them first.</p>
<p>In the case of OpenVPN you can stop its web server with:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> openvpnas stop</code></pre></div>
<p>Then you can run certbot command line with the following options:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> certbot certonly <span class="token punctuation">\</span>
  --standalone <span class="token punctuation">\</span>
  --non-interactive <span class="token punctuation">\</span>
  --agree-tos <span class="token punctuation">\</span>
  --email YOUR_CERTIFICATE_EMAIL <span class="token punctuation">\</span>
  --domains YOUR_DOMAIN <span class="token punctuation">\</span>
  --pre-hook <span class="token string">'sudo service openvpnas stop'</span> <span class="token punctuation">\</span>
  --post-hook <span class="token string">'sudo service openvpnas start'</span></code></pre></div>
<p>Let’s see briefly what every option is doing:</p>
<ul>
<li><code>--standalone</code>: runs the standalone web server for the verification process.</li>
<li><code>--non-interactive</code>: runs in totally automated mode, never asks for input.</li>
<li><code>--agree-tos</code>: needed to make the above work, with this parameter you are confirming you agree to the terms of service.</li>
<li><code>--email</code>: the certificate email.</li>
<li><code>--domains</code>: the certificate domain.</li>
<li><code>--pre-hook</code>: this is needed for the auto-renewal of the certificate and describes what is the command to run before the renewal process can be executed. We are using it to stop the OpenVPN web interface.</li>
<li><code>--post-hook</code>: similar to the previous one, allows us to specify a command to be executed after a certificate is renewed, we use it to restart the OpenVPN web interface.</li>
</ul>
<p>This command generates numerous files including <code>server.crt</code> and <code>server.key</code>, the two files we need to use in OpenVPN. So let’s link them into the proper OpenVPN folder:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">ln</span> -s -f /etc/letsencrypt/live/YOUR_DOMAIN/cert.pem /usr/local/openvpn_as/etc/web-ssl/server.crt
<span class="token function">sudo</span> <span class="token function">ln</span> -s -f /etc/letsencrypt/live/YOUR_DOMAIN/privkey.pem /usr/local/openvpn_as/etc/web-ssl/server.key</code></pre></div>
<p>We link them because they will be changed in the future by the renewal process, so we are sure that OpenVPN will be always using the most updated certificate files.</p>
<p>And, finally, we can restart OpenVPN:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> openvpnas start</code></pre></div>
<p>After few seconds your OpenVPN website should be up and running, and with a shiny green icon indicating that the website is properly encrypted through a signed certificate, woohoo, well done!</p>
<h2 id="a-complete-example-infrastructure-with-terraform" style="position:relative;"><a href="#a-complete-example-infrastructure-with-terraform" aria-label="a complete example infrastructure with terraform permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A complete example infrastructure with Terraform</h2>
<p>I am happy to share with you a simplified version of my Terraform OpenVPN project, to give you an example of how you can use the aforementioned details in a Terraform context.</p>
<p>All the code available in the following section is also available as a <a href="https://github.com/lmammino/terraform-openvpn">repository on GitHub</a>.</p>
<p>Let’s start with a list of the AWS resources we need in order to provision a fully functional OpenVPN:</p>
<ul>
<li>A <strong>VPC</strong> (Virtual Private Cloud)</li>
<li>One or more <strong>subnets</strong> in the VPC</li>
<li>A <strong>EC2 instance</strong> to host OpenVPN</li>
<li>A <strong>key pair</strong> to be able to SSH into the OpenVPN machine (for maintenance or troubleshooting)</li>
<li>A <strong>security group</strong> (to enable traffic inside and outside the EC2 instance)</li>
<li>A <strong>DNS record</strong> in Route53 to expose our VPN in a subdomain</li>
</ul>
<p>Quite a few things to be honest, but the declarative nature of Terraform will make things easy.</p>
<p>Let’s create a file called <code>openvpn.tf</code> and let’s start to add things there:</p>
<h3 id="vpc--subnet" style="position:relative;"><a href="#vpc--subnet" aria-label="vpc  subnet permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>VPC &#x26; Subnet</h3>
<p>Let’s create the VPC and the subnet:</p>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "vpc_cidr_block" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"10.0.0.0/16"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "subnet_cidr_block" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"10.0.0.0/16"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"aws_vpc"</span></span> <span class="token string">"main"</span> <span class="token punctuation">{</span>
  <span class="token property">cidr_block</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">vpc_cidr_block</span><span class="token punctuation">}</span></span>"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"aws_subnet"</span></span> <span class="token string">"vpn_subnet"</span> <span class="token punctuation">{</span>
  <span class="token property">vpc_id</span>     <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_vpc<span class="token punctuation">.</span>main<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>"</span>
  <span class="token property">cidr_block</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">subnet_cidr_block</span><span class="token punctuation">}</span></span>"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Here we are using two variables <code>vpc_cidr_block</code> and <code>subnet_cidr_block</code> that can be easily reassigned from the outside to change the configuration if needed. By default, we are creating a VPC on the <code>10.0.0.0/16</code> IP range and a subnet spawning over the full VPN (same IP range).</p>
<p>The rest of the code describing the VPC and the Subnet resources should be pretty self-explanatory.</p>
<h3 id="the-key-pair" style="position:relative;"><a href="#the-key-pair" aria-label="the key pair permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The key pair</h3>
<p>Let’s create now the SSH key that we can use later in case we want to SSH into the OpenVPN machine.</p>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "public_key" </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"aws_key_pair"</span></span> <span class="token string">"openvpn"</span> <span class="token punctuation">{</span>
  <span class="token property">key_name</span>   <span class="token punctuation">=</span> <span class="token string">"openvpn-key"</span>
  <span class="token property">public_key</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">public_key</span><span class="token punctuation">}</span></span>"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Basically we are only defining here a <code>aws_key_pair</code> resource and specifying a name and the public key.</p>
<p>Public key is a string that comes from the variable <code>public_key</code>.</p>
<p>Most of the time you will be creating a dedicated key with the following command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">ssh-keygen -f openvpn.key</code></pre></div>
<p>this will create <code>openvpn.key</code> (private key) and <code>openvpn.key.pub</code> (public key). The first one is the one we would reference here.</p>
<p>If we want to reference the content of a file we can use <code>"${file("openvpn.key.pub")}"</code> to assign a terraform variable.</p>
<h3 id="security-group" style="position:relative;"><a href="#security-group" aria-label="security group permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Security group</h3>
<p>Let’s create our security group:</p>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "ssh_port" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token number">22</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "ssh_cidr" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"0.0.0.0/0"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "https_port" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token number">443</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "https_cidr" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"0.0.0.0/0"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "tcp_port" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token number">943</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "tcp_cidr" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"0.0.0.0/0"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "udp_port" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token number">1194</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "udp_cidr" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"0.0.0.0/0"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"aws_security_group"</span></span> <span class="token string">"openvpn"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span>        <span class="token punctuation">=</span> <span class="token string">"openvpn_sg"</span>
  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">"Allow traffic needed by openvpn"</span>
  <span class="token property">vpc_id</span>      <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_vpc<span class="token punctuation">.</span>main<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>"</span>

  <span class="token comment">// ssh</span>
  <span class="token keyword">ingress</span> <span class="token punctuation">{</span>
    <span class="token property">from_port</span>   <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">ssh_port</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">to_port</span>     <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">ssh_port</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">protocol</span>    <span class="token punctuation">=</span> <span class="token string">"tcp"</span>
    <span class="token property">cidr_blocks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">ssh_cidr</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// https</span>
  <span class="token keyword">ingress</span> <span class="token punctuation">{</span>
    <span class="token property">from_port</span>   <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">https_port</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">to_port</span>     <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">https_port</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">protocol</span>    <span class="token punctuation">=</span> <span class="token string">"tcp"</span>
    <span class="token property">cidr_blocks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">https_cidr</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// open vpn tcp</span>
  <span class="token keyword">ingress</span> <span class="token punctuation">{</span>
    <span class="token property">from_port</span>   <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">tcp_port</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">to_port</span>     <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">tcp_port</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">protocol</span>    <span class="token punctuation">=</span> <span class="token string">"tcp"</span>
    <span class="token property">cidr_blocks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">tcp_cidr</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// open vpn udp</span>
  <span class="token keyword">ingress</span> <span class="token punctuation">{</span>
    <span class="token property">from_port</span>   <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">udp_port</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">to_port</span>     <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">udp_port</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">protocol</span>    <span class="token punctuation">=</span> <span class="token string">"udp"</span>
    <span class="token property">cidr_blocks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">udp_cidr</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// all outbound traffic</span>
  <span class="token keyword">egress</span> <span class="token punctuation">{</span>
    <span class="token property">from_port</span>   <span class="token punctuation">=</span> <span class="token number">0</span>
    <span class="token property">to_port</span>     <span class="token punctuation">=</span> <span class="token number">0</span>
    <span class="token property">protocol</span>    <span class="token punctuation">=</span> <span class="token string">"-1"</span>
    <span class="token property">cidr_blocks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"0.0.0.0/0"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>By default, this Security group allows access from every IP address using the ports 22 (SSH), 433 (HTTPS) and all outside traffic. It also enables the traffic needed for the OpenVPN protocol both on TCP (port 943) and UDP (port 1194).
In case you want a custom setup, you can redefine all the relevant variables here (but in that case you might need to customise also the OpenVPN settings, a step which is not covered in this article).</p>
<h3 id="subdomain" style="position:relative;"><a href="#subdomain" aria-label="subdomain permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subdomain</h3>
<p>Let’s now create the subdomain from where our VPN will be accessible.</p>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "route53_zone_name" </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">variable<span class="token type variable"> "subdomain_name" </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "subdomain_ttl" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"60"</span>
<span class="token punctuation">}</span>

<span class="token keyword">data <span class="token type variable">"aws_route53_zone"</span></span> <span class="token string">"main"</span> <span class="token punctuation">{</span>
  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">route53_zone_name</span><span class="token punctuation">}</span></span>"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"aws_route53_record"</span></span> <span class="token string">"vpn"</span> <span class="token punctuation">{</span>
  <span class="token property">zone_id</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">data</span><span class="token punctuation">.</span><span class="token type variable">aws_route53_zone</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>zone_id<span class="token punctuation">}</span></span>"</span>
  <span class="token property">name</span>    <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">subdomain_name</span><span class="token punctuation">}</span></span>"</span>
  <span class="token property">type</span>    <span class="token punctuation">=</span> <span class="token string">"A"</span>
  <span class="token property">ttl</span>     <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">subdomain_ttl</span><span class="token punctuation">}</span></span>"</span>
  <span class="token property">records</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_instance<span class="token punctuation">.</span>openvpn<span class="token punctuation">.</span>public_ip<span class="token punctuation">}</span></span>"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In this part of the code, we are defining 3 variables:</p>
<ul>
<li><code>route53_zone_name</code>: the name of your main domain zone (e.g. “example.com.”, notice the dot at the end).</li>
<li><code>subdomain_name</code>: the name of the subdomain to use for the VPN (e.g. “vpn.example.com”).</li>
<li><code>subdomain_ttl</code>: the TTL for the domain (60 seconds by default).</li>
</ul>
<p>Then, we create a reference to the Route53 zone using the <code>data</code> syntax.</p>
<p>Finally, we create the record in the zone using an <code>aws_route53_record</code> resource.</p>
<p>Notice that we are referencing here the EC2 instance public IP, which we haven’t defined yet.</p>
<h3 id="ec2-instance" style="position:relative;"><a href="#ec2-instance" aria-label="ec2 instance permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>EC2 instance</h3>
<p>Let’s see now how we can define the EC2 instance that will host the OpenVPN software for our virtual private cloud:</p>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "ami" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"ami-f53d7386"</span> <span class="token comment">// ubuntu xenial openvpn ami in eu-west-1</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "instance_type" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"t2.medium"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "admin_user" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"openvpn"</span>
<span class="token punctuation">}</span>

<span class="token keyword">variable<span class="token type variable"> "admin_password" </span></span><span class="token punctuation">{</span>
  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">"openvpn"</span>
<span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"aws_instance"</span></span> <span class="token string">"openvpn"</span> <span class="token punctuation">{</span>
  <span class="token keyword">tags</span> <span class="token punctuation">{</span>
    <span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">"openvpn"</span>
  <span class="token punctuation">}</span>

  <span class="token property">ami</span>                         <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">ami</span><span class="token punctuation">}</span></span>"</span>
  <span class="token property">instance_type</span>               <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">instance_type</span><span class="token punctuation">}</span></span>"</span>
  <span class="token property">key_name</span>                    <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_key_pair<span class="token punctuation">.</span>openvpn<span class="token punctuation">.</span>key_name<span class="token punctuation">}</span></span>"</span>
  <span class="token property">subnet_id</span>                   <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_subnet<span class="token punctuation">.</span>vpn_subnet<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>"</span>
  <span class="token property">vpc_security_group_ids</span>      <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_security_group<span class="token punctuation">.</span>openvpn<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>"</span><span class="token punctuation">]</span>
  <span class="token property">associate_public_ip_address</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>

  <span class="token comment"># `admin_user` and `admin_pw` need to be passed in to the appliance through `user_data`, see docs --></span>
  <span class="token comment"># https://docs.openvpn.net/how-to-tutorialsguides/virtual-platforms/amazon-ec2-appliance-ami-quick-start-guide/</span>
  <span class="token property">user_data</span> <span class="token punctuation">=</span> <span class="token heredoc string">&lt;&lt;USERDATA
admin_user=${var.admin_user}
admin_pw=${var.admin_password}
USERDATA</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In this piece of code we are defining some variables:</p>
<ul>
<li><code>ami</code>: the id of the AMI (Amazon Machine Image) to use to run the EC2 instance. The default one is a Ubuntu Xenial OpenVPN machine that runs on the eu-west-1 region (Ireland). Feel free to <a href="https://cloud-images.ubuntu.com/locator/ec2/">select another image</a> that might suit your needs best.</li>
<li><code>instance_type</code>: the type of instance. You can check the <a href="https://aws.amazon.com/ec2/instance-types/">list of all the type of EC2 instances</a> to understand which one might be the best for you. The default here is ok for most of the use cases.</li>
<li><code>admin_user</code>, <code>admin_password</code>: The username and password of the admin user for your VPN.</li>
</ul>
<p>Whit all those variable in place, we can describe a <code>aws_instance</code> resource. Notice that we are defining it so that it will be bootstrapped in our VPC and in the subnet we specified before. Also notice that we are setting <code>associate_public_ip_address</code> to <code>true</code>, this way the machine will get a public IP (the one we will associate to the subdomain defined earlier).</p>
<p>Finally we define a <code>user_data</code> property. <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html#instancedata-add-user-data">EC2 User Data</a> allows to provide extra configuration code that is executed as soon as the machine is bootstrapped. It is generally used to install extra software, start some service or edit configuration values. In our case, since our image already contains OpenVPN, we use it only to provide the credentials for the default OpenVPN admin user.</p>
<h3 id="trigger-based-provisioning-with-null_resource" style="position:relative;"><a href="#trigger-based-provisioning-with-null_resource" aria-label="trigger based provisioning with null_resource permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Trigger-based provisioning with <code>null_resource</code></h3>
<p>At this point we created all the resources we need and the OpenVPN admin can be already accessed by pointing the browser to your custom subdomain (using the HTTPS protocol).</p>
<p>If you try to do that though, you will get a warning page saying that the certificate for this domain is not valid. This is because OpenVPN is using an auto-generated self-signed certificate which is not bound to your domain, neither signed by a trusted authority (such as Let’s Encrypt).</p>
<p>So let’s do the interesting bit here, adding a Let’s Encrypt certificate for our subdomain!</p>
<p>If you got the basics of Terraform and AWS here you might think that we can do this by simply adding few lines to our EC2 User Data script. While this, in theory, is not wrong, is not going to work in this case because of the way our resources here depend on each other. Let’s clarify exactly why…</p>
<p>So in our current situation, we have to respect the following order of creating resources:</p>
<ol>
<li>Create a VPC</li>
<li>Create a Subnet in the VPC</li>
<li>Create a key pair and a security group</li>
<li>Create an EC2 instance</li>
<li>Create a subdomain record pointing to the public address of the EC2 instance</li>
<li>(TODO) Create the certificate and install into the current OpenVPN instance</li>
</ol>
<p>So, the subdomain record can be created only after the EC2 instance is running and it has got a public IP address, only then we have a valid domain that we can use for the certificate. This means we cannot use the EC2 provisioning step, but we need to have a “trigger” that tells us when the subdomain is available and do some extra stuff.</p>
<p>Terraform is smart enough to reconstruct the dependency graph of all our resources and to create the resources in the right order, so we don’t need to worry about that and we can keep loving the declarative style of its syntax.</p>
<p>This means that the only thing left to do is to specify this trigger, which we can do by using a <a href="https://www.terraform.io/docs/provisioners/null_resource.html"><code>null_resource</code></a>.</p>
<p>Quoting the official documentation:</p>
<blockquote>
<p>The <code>null_resource</code> is a resource that allows you to configure provisioners that are not directly associated with a single existing resource.</p>
</blockquote>
<p>Let’s jump straight into the code, which I believe will make everything clear:</p>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "certificate_email" </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">resource <span class="token type variable">"null_resource"</span></span> <span class="token string">"provision_openvpn"</span> <span class="token punctuation">{</span>
  <span class="token keyword">triggers</span> <span class="token punctuation">{</span>
    <span class="token property">subdomain_id</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_route53_record<span class="token punctuation">.</span>vpn<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span>"</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">connection</span> <span class="token punctuation">{</span>
    <span class="token property">type</span>        <span class="token punctuation">=</span> <span class="token string">"ssh"</span>
    <span class="token property">host</span>        <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_instance<span class="token punctuation">.</span>openvpn<span class="token punctuation">.</span>public_ip<span class="token punctuation">}</span></span>"</span>
    <span class="token property">user</span>        <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">ssh_user</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">private_key</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">private_key</span><span class="token punctuation">}</span></span>"</span>
    <span class="token property">agent</span>       <span class="token punctuation">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">provisioner<span class="token type variable"> "remote-exec" </span></span><span class="token punctuation">{</span>
    <span class="token property">inline</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
      <span class="token string">"sudo apt-get install -y curl vim libltdl7 python3 python3-pip python software-properties-common unattended-upgrades"</span>,
      <span class="token string">"sudo add-apt-repository -y ppa:certbot/certbot"</span>,
      <span class="token string">"sudo apt-get -y update"</span>,
      <span class="token string">"sudo apt-get -y install python-certbot certbot"</span>,
      <span class="token string">"sudo service openvpnas stop"</span>,
      <span class="token string">"sudo certbot certonly --standalone --non-interactive --agree-tos --email <span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">certificate_email</span><span class="token punctuation">}</span></span> --domains <span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">subdomain_name</span><span class="token punctuation">}</span></span> --pre-hook 'service openvpnas stop' --post-hook 'service openvpnas start'"</span>,
      <span class="token string">"sudo ln -s -f /etc/letsencrypt/live/<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">subdomain_name</span><span class="token punctuation">}</span></span>/cert.pem /usr/local/openvpn_as/etc/web-ssl/server.crt"</span>,
      <span class="token string">"sudo ln -s -f /etc/letsencrypt/live/<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">subdomain_name</span><span class="token punctuation">}</span></span>/privkey.pem /usr/local/openvpn_as/etc/web-ssl/server.key"</span>,
      <span class="token string">"sudo service openvpnas start"</span>,
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>As you can see at the very top of this snippet of code, we are declaring a <code>null_resource</code> that is triggered when the value <code>aws_route53_record.vpn.id</code> changes, which happens when the subdomain is created. When this happens, Terraform will execute the provisioning logic defined in the rest of the code here, which essentially describes to Terraform how to connect to the OpenVPN machine and what code needs to be run and which we already discussed in the first part of this article.</p>
<h3 id="the-provider-configuration-and-the-variable-file" style="position:relative;"><a href="#the-provider-configuration-and-the-variable-file" aria-label="the provider configuration and the variable file permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The provider configuration and the variable file</h3>
<p>Ok, our setup is almost ready… The only two things we have left to do are:</p>
<ul>
<li>define the needed configuration to connect to our AWS account;</li>
<li>define some values for our configuration before we can run Terraform.</li>
</ul>
<p>To define the AWS config we need to specify the following terraform code (I generally do that into a dedicated file called <code>provider.tf</code>, but you can write this in any terraform file in your project):</p>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token keyword">variable<span class="token type variable"> "aws_profile_name" </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">variable<span class="token type variable"> "aws_region" </span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">provider<span class="token type variable"> "aws" </span></span><span class="token punctuation">{</span>
  <span class="token property">profile</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">aws_profile_name</span><span class="token punctuation">}</span></span>"</span>
  <span class="token property">region</span>  <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">aws_region</span><span class="token punctuation">}</span></span>"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Finally we can define the values for our variables. To do so we need to create a file called <code>terraform.tfvars</code> which contains a simple list of key-value pairs:</p>
<div class="gatsby-highlight" data-language="hcl"><pre class="language-hcl"><code class="language-hcl"><span class="token property">aws_profile_name</span> <span class="token punctuation">=</span> <span class="token string">"default"</span>
<span class="token property">aws_region</span> <span class="token punctuation">=</span> <span class="token string">"eu-west-1"</span>
<span class="token property">public_key</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"key.pub"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>"</span>
<span class="token property">private_key</span> <span class="token punctuation">=</span> <span class="token string">"<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>"</span>
<span class="token property">certificate_email</span> <span class="token punctuation">=</span> <span class="token string">"tech@example.com"</span>
<span class="token property">route53_zone_name</span> <span class="token punctuation">=</span> <span class="token string">"example.com."</span>
<span class="token property">subdomain_name</span> <span class="token punctuation">=</span> <span class="token string">"vpn.example.com"</span>

<span class="token comment"># vpc_cidr_block = "10.0.0.0/16"</span>
<span class="token comment"># subnet_cidr_block = "10.0.0.0/16"</span>
<span class="token comment"># ssh_port = 22</span>
<span class="token comment"># ssh_cidr = "0.0.0.0/0"</span>
<span class="token comment"># https_port = 443</span>
<span class="token comment"># https_cidr = "0.0.0.0/0"</span>
<span class="token comment"># tcp_port = 943</span>
<span class="token comment"># tcp_cidr = "0.0.0.0/0"</span>
<span class="token comment"># udp_port = 1194</span>
<span class="token comment"># udp_cidr = "0.0.0.0/0"</span>
<span class="token comment"># subdomain_ttl = 60</span>
<span class="token comment"># ami = "ami-f53d7386"</span>
<span class="token comment"># instance_type = "t2.medium"</span>
<span class="token comment"># admin_user = "openvpn"</span>
<span class="token comment"># admin_password = "openvpn"</span></code></pre></div>
<p>The commented lines (starting with <code>#</code>) are left for your own reference, in case you want to change one of the configuration defaults.</p>
<h3 id="plan-apply-and-destroy" style="position:relative;"><a href="#plan-apply-and-destroy" aria-label="plan apply and destroy permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Plan, apply and destroy</h3>
<p>Ok, we are finally ready to run our Terraform project.</p>
<p>In order to see what changes will be applied to your AWS account, your will need to run:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">terraform plan</code></pre></div>
<p>If you are happy with the displayed changes you can confirm them with:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">terraform apply</code></pre></div>
<p>After few minutes you will have a fully provisioned Virtual Private Cloud with its own VPN access. Try to connect to the domain (<a href="https://vpn.example.com">https://vpn.example.com</a>) and login in with your admin username and password!</p>
<p>Ok, this was probably just a test project for you so you might fancy cleaning everything up… No problem, just run:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">terraform destroy</code></pre></div>
<p>and everything we just created will be blown away from your AWS account, leaving no trace behind!</p>
<h2 id="some-extra-tips" style="position:relative;"><a href="#some-extra-tips" aria-label="some extra tips permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Some extra tips</h2>
<p>Just few extra tips before closing off…</p>
<h3 id="lets-encrypt-throttling" style="position:relative;"><a href="#lets-encrypt-throttling" aria-label="lets encrypt throttling permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Let’s Encrypt throttling</h3>
<p>Let’s Encrypt allows you to generate a <strong>limited number of certificates for a given domain on a given timespan</strong>.</p>
<p>Quoting directly from <a href="https://letsencrypt.org/docs/rate-limits/">the Let’s Encrypt Rate Limit documentation</a>:</p>
<blockquote>
<p>The main limit is <strong>Certificates per Registered Domain (20 per week)</strong>. A registered domain is, generally speaking, the part of the domain you purchased from your domain name registrar. For instance, in the name www.example.com, the registered domain is example.com. In new.blog.example.co.uk, the registered domain is example.co.uk. We use the Public Suffix List to calculate the registered domain.</p>
<p>If you have a lot of subdomains, you may want to combine them into a single certificate, up to a limit of 100 Names per Certificate. Combined with the above limit, that means you can issue certificates containing up to <strong>2,000 unique subdomains per week</strong>. A certificate with multiple names is often called a SAN certificate, or sometimes a UCC certificate.</p>
<p>We also have a <strong>Duplicate Certificate limit of 5 certificates per week</strong>. A certificate is considered a duplicate of an earlier certificate if they contain the exact same set of hostnames, ignoring capitalization and ordering of hostnames. For instance, if you requested a certificate for the names [www.example.com, example.com], you could request four more certificates for [www.example.com, example.com] during the week. If you changed the set of names by adding [blog.example.com], you would be able to request additional certificates.</p>
</blockquote>
<p>So, be careful not to blow your production domain while playing with Terraform (or with certbot in general).</p>
<p>There are options to generate <em>test</em> or <em>staging</em> certificates, although I haven’t experimented much with them, so I can only suggest you to have a look at the documentation illustration all the <a href="https://certbot.eff.org/docs/using.html#certbot-command-line-options">available command line options</a>.</p>
<p>Huge thanks to <a href="https://www.reddit.com/user/tialaramex">tialaramex</a> on Reddit for <a href="https://www.reddit.com/r/linuxadmin/comments/6ia1wx/use_certbot_to_automate_the_creation_of_ssl/dj57zlw/">a fruitful discussion</a> and few pieces of advice about this specific aspect.</p>
<h3 id="certificate-expiry-and-renewal" style="position:relative;"><a href="#certificate-expiry-and-renewal" aria-label="certificate expiry and renewal permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Certificate expiry and renewal</h3>
<p>Let’s Encrypt <strong>certificates expire after 3 months</strong>, so be sure you enable the auto renewal feature.</p>
<p>In reality, the feature is enabled by default, so what’s left to do is to test the auto renewal process. With certbot you can do that using the following command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">certbot renew --dry-run</code></pre></div>
<p>There’s another important point here to take into account here: everytime the certificate renewal procedure is triggered, your VPN service gets shutdown for few seconds and all the currently connected users are disconnected.</p>
<p>This will happen only once every 2-3 months, but if it’s a real struggle for your organisation you might want to explore different setups.</p>
<p>One solution could be to setup a reverse proxy like Nginx and use it for the SSL termination. This way during the renewal you will only shutdown nginx and not the full VPN service.</p>
<p>Thanks again to <a href="https://www.reddit.com/user/tialaramex">tialaramex</a> on Reddit for raising this discussion and proposing the reverse proxy solution.</p>
<h3 id="intermittent-failures-during-the-provisioning" style="position:relative;"><a href="#intermittent-failures-during-the-provisioning" aria-label="intermittent failures during the provisioning permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Intermittent failures during the provisioning</h3>
<p>I had some problems during the installation of certbot on the image used here by default. If this is happening to you as well, you should be able to sort them out by running an <code>apt-get upgrade</code> before trying to install certbot. Since you want to do that in an automated fashion, you’ll probably need a more sophisticated command that takes care of auto-responding to possible prompts: <code>yes | sudo DEBIAN_FRONTEND=noninteractive apt-get upgrade</code>.</p>
<h2 id="wrapping-up" style="position:relative;"><a href="#wrapping-up" aria-label="wrapping up permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Wrapping up</h2>
<p>This is just a quick example focused on OpenVPN, but you can use the same approach to generate certificates for other web applications. Consult the <a href="https://certbot.eff.org/docs/">Certbot documentation </a> to see all the supported web servers and how to use Certbot with them.</p>
<p>Also, I hope this tutorial gave you a good idea on how to use Terraform to automate your infrastructure provisioning. I am still a bit of noob with it, so if you see I have done something terribly wrong (or something that can be improved), please let me know in the comments.</p>
<p>Thanks to <a href="https://twitter.com/Podgeypoos79">@Podgeypoos79</a>, <a href="https://twitter.com/tech_fort">@techfort</a>, <em>Alan</em> and the rest of Planet 9 tech team for working with me on this cool 💩 (chocolate ice cream!). Also a huge thanks to my friend <a href="https://twitter.com/gianarb">@gianarb</a> for some precious <em>devopsy</em> bits of advice.</p>
<p>Let me know in the comments if this article was useful for you and if you integrated something similar in one of your projects!</p>
<p>See you in the next post :)</p></article><style data-emotion-css="1l1pps0">.css-1l1pps0{margin:2em 0;line-height:25px;padding:1em;font-size:small;border-radius:8px;background:rgba(255,229,100,0.3);}.css-1l1pps0 a{-webkit-text-decoration:none;text-decoration:none;border-bottom:2px solid #ffe564;color:inherit;}.css-1l1pps0 a:hover{border-bottom:2px solid #ff9b51;}@media (min-width:780px){.css-1l1pps0{padding:2em 2em;}}</style><div class="css-1l1pps0 ep8980s1"><strong>Found a typo or something that can be improved?</strong><br/>In the spirit of Open Source, you can contribute to this article by<!-- --> <a href="https://github.com/lmammino/loige.co/blob/master/content/posts/2017-06-19_using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/index.md" target="_blank" rel="noopener noreferrer">submitting a PR on <svg aria-label="GitHub" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg> GitHub</a></div><div style="border-top:1px solid #ececec;margin-top:2em;padding-top:2em;line-height:1.2" class="css-1qj4z9r ep8980s0"><h2 id="comments"><svg aria-hidden="true" data-prefix="fas" data-icon="comments" class="svg-inline--fa fa-comments fa-w-18" viewBox="0 0 576 512" width="1em" height="1em" style="margin:0 .25em 0 0"><path fill="currentColor" d="M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"></path></svg> Comments</h2><div shortname="loige" config="[object Object]" id="disqus_thread"></div></div></main><style data-emotion-css="112aol2">.css-112aol2{-webkit-flex:1;-ms-flex:1;flex:1;background:#f7f7f7;padding:1em;margin:0 0 2em 0;}.css-112aol2 h3{margin:0 0 0.5em 0;position:relative;color:#111;}@media (min-width:780px){.css-112aol2{background:transparent;margin:0 0 1em 0;}.css-112aol2 > div{margin:1em 0 0 0;position:-webkit-sticky;position:sticky;overflow-y:auto;top:70px;}}</style><aside class="css-112aol2 e1kc7zwr4"><style data-emotion-css="1jztyo0">.css-1jztyo0{background:#ffffcd;padding:0.5em;font-size:12px;display:block;color:inherit;-webkit-text-decoration:none;text-decoration:none;border:1px solid #ffffcd;margin:0 0 1em 0;}.css-1jztyo0:hover{border-color:#f89000;}</style><a href="https://nodejsdp.link" class="css-1jztyo0 e1pruv500"><style data-emotion-css="p58oka">.css-p58oka{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><span class="css-p58oka e1pruv501"><style data-emotion-css="13cvdli">.css-13cvdli{width:50%;padding:0 0 0 1em;display:block;}.css-13cvdli.left{max-width:125px;padding:0 0 0 1em !important;}@media (max-width:1024px) and (min-width:780px){.css-13cvdli{width:100%;max-width:auto !important;margin:0;}.css-13cvdli.left{padding:0 0 0 1em;}.css-13cvdli h4{padding:1em 0 0.5em 0 !important;}}.css-13cvdli:first-of-type{padding:0;}.css-13cvdli h4{padding:0 0 0.5em 0;font-size:14px;}</style><span class="left css-13cvdli e1pruv502"><img src="/static/200-d93eec50cb245374fcbc6cacd4f736e3.jpg" style="width:100%" alt="Node.js Design Patterns Third Edition"/></span><span class="css-13cvdli e1pruv502"><h4>Node.js Design Patterns</h4><p>Design and implement production-grade <strong>Node.js</strong> <!-- -->applications using proven patterns and techniques with<!-- --> <em>Node.js Design Patterns Third Edition</em>. Available as<!-- --> <strong>Digital</strong> and <strong>Print</strong>.</p></span></span></a><div><style data-emotion-css="exth3p">.css-exth3p ol{color:#6d6d6d;padding:0 0 0 2em;list-style:decimal-leading-zero;}.css-exth3p ol ol{padding:0 0 0 0.3em;}.css-exth3p ol li{font-size:0.8rem;font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace;margin-top:5px;color:#111;}.css-exth3p ol li a{font-size:1.2em;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;color:#6d6d6d;border-bottom:1px solid transparent;-webkit-text-decoration:none;text-decoration:none;font-weight:bold;}.css-exth3p ol li a:hover{color:#000;outline-width:0;}.css-exth3p ol li.depth-3{font-size:0.8em;list-style:none;}</style><div class="css-exth3p eu4hp7r0"><h3>Sections</h3><ol><li class="depth-2"><a href="#installing-certbot">Installing Certbot</a></li><li class="depth-2"><a href="#generating-a-certificate-with-certbot">Generating a certificate with Certbot</a></li><li class="depth-2"><a href="#a-complete-example-infrastructure-with-terraform">A complete example infrastructure with Terraform</a><ol><li class="depth-3"><a href="#vpc--subnet">VPC & Subnet</a></li><li class="depth-3"><a href="#the-key-pair">The key pair</a></li><li class="depth-3"><a href="#security-group">Security group</a></li><li class="depth-3"><a href="#subdomain">Subdomain</a></li><li class="depth-3"><a href="#ec2-instance">EC2 instance</a></li><li class="depth-3"><a href="#trigger-based-provisioning-with-null_resource">Trigger-based provisioning with null_resource</a></li><li class="depth-3"><a href="#the-provider-configuration-and-the-variable-file">The provider configuration and the variable file</a></li><li class="depth-3"><a href="#plan-apply-and-destroy">Plan, apply and destroy</a></li></ol></li><li class="depth-2"><a href="#some-extra-tips">Some extra tips</a><ol><li class="depth-3"><a href="#lets-encrypt-throttling">Let’s Encrypt throttling</a></li><li class="depth-3"><a href="#certificate-expiry-and-renewal">Certificate expiry and renewal</a></li><li class="depth-3"><a href="#intermittent-failures-during-the-provisioning">Intermittent failures during the provisioning</a></li></ol></li><li class="depth-2"><a href="#wrapping-up">Wrapping up</a></li></ol></div><h3 style="margin-top:1em">Share</h3><style data-emotion-css="125xt49">.css-125xt49{list-style:none;font-size:30px;padding:0.2em 0;}.css-125xt49 li{display:inline-block;margin:0 0.2em 0 0;}.css-125xt49 li a{color:#6d6d6d;}.css-125xt49 li a.twitter:hover{color:#00aced;}.css-125xt49 li a.facebook:hover{color:#3b5998;}.css-125xt49 li a.linkedin:hover{color:#007bb6;}.css-125xt49 li a.pinterest:hover{color:#cb2027;}.css-125xt49 li a.email:hover{color:black;}</style><ul class="css-125xt49 ey4v4xz0"><li><a rel="nofollow noopener noreferrer" class="twitter" target="_blank" href="https://twitter.com/intent/tweet?text=Using%20Let%E2%80%99s%20Encrypt%20and%20Certbot%20to%20automate%20the%20creation%20of%20certificates%20for%20OpenVPN&amp;url=https%3A%2F%2Floige.co%2Fusing-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn%2F&amp;source=https%3A%2F%2Floige.co&amp;related=loige&amp;via=loige" title="Share via twitter"><svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Floige.co%2Fusing-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn%2F" title="Share via facebook"><svg aria-hidden="true" data-prefix="fab" data-icon="facebook-square" class="svg-inline--fa fa-facebook-square fa-w-14" viewBox="0 0 448 512" width="1em" height="1em"><path fill="currentColor" d="M448 80v352c0 26.5-21.5 48-48 48h-85.3V302.8h60.6l8.7-67.6h-69.3V192c0-19.6 5.4-32.9 33.5-32.9H384V98.7c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9H184v67.6h60.9V480H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="linkedin" target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Floige.co%2Fusing-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn%2F&amp;title=Using%20Let%E2%80%99s%20Encrypt%20and%20Certbot%20to%20automate%20the%20creation%20of%20certificates%20for%20OpenVPN&amp;source=https%3A%2F%2Floige.co" title="Share via linkedin"><svg aria-hidden="true" data-prefix="fab" data-icon="linkedin-in" class="svg-inline--fa fa-linkedin-in fa-w-14" viewBox="0 0 448 512" width="1em" height="1em"><path fill="currentColor" d="M100.3 480H7.4V180.9h92.9V480zM53.8 140.1C24.1 140.1 0 115.5 0 85.8 0 56.1 24.1 32 53.8 32c29.7 0 53.8 24.1 53.8 53.8 0 29.7-24.1 54.3-53.8 54.3zM448 480h-92.7V334.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V480h-92.8V180.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V480z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="pinterest" target="_blank" href="https://pinterest.com/pin/create/button/?media=https%3A%2F%2Floige.co%2Fstatic%2F45dfcbcf12ab7cac8a20f867207af385%2Fusing-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn-loige-icover-image.jpg&amp;url=https%3A%2F%2Floige.co%2Fusing-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn%2F&amp;is_video=false&amp;description=Using%20Let%E2%80%99s%20Encrypt%20and%20Certbot%20to%20automate%20the%20creation%20of%20certificates%20for%20OpenVPN" title="Share via pinterest"><svg aria-hidden="true" data-prefix="fab" data-icon="pinterest" class="svg-inline--fa fa-pinterest fa-w-16" viewBox="0 0 496 512" width="1em" height="1em"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"></path></svg></a></li><li><a rel="nofollow noopener noreferrer" class="email" target="_blank" href="mailto:?&amp;body=%0AUsing%20Let%E2%80%99s%20Encrypt%20and%20Certbot%20to%20automate%20the%20creation%20of%20certificates%20for%20OpenVPN%0A%0Ahttps%3A%2F%2Floige.co%2Fusing-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn%2F&amp;subject=Using%20Let%E2%80%99s%20Encrypt%20and%20Certbot%20to%20automate%20the%20creation%20of%20certificates%20for%20OpenVPN" title="Share via email"><svg aria-hidden="true" data-prefix="far" data-icon="envelope" class="svg-inline--fa fa-envelope fa-w-16" viewBox="0 0 512 512" width="1em" height="1em"><path fill="currentColor" d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"></path></svg></a></li></ul><h3 style="margin-top:1em">Similar posts</h3><style data-emotion-css="11m37pp">.css-11m37pp{color:#6d6d6d;list-style:outside;padding:0 0 0 1.25em;}.css-11m37pp li{margin:0.75em 0 0 0;}.css-11m37pp li:first-of-type{margin-top:0;}.css-11m37pp a{color:#6d6d6d;-webkit-text-decoration:none;text-decoration:none;font-weight:bold;}.css-11m37pp a:hover{color:#000;}</style><ul class="css-11m37pp e1empo690"><li><a href="/aws-solution-architect-associate-exam-notes-tips">AWS Solution Architect Associate exam, my notes and tips</a></li><li><a href="/aws-command-line-s3-content-from-stdin-or-to-stdout">AWS Command line: S3 content from stdin or to stdout</a></li><li><a href="/from-bare-metal-to-serverless">From bare metal to Serverless</a></li><li><a href="/8-invitations-to-try-keybase-io">8 invitations to try Keybase.io</a></li><li><a href="/reset-your-mysql-server-password">Reset your MySql server password</a></li></ul></div></aside></div></section></div><style data-emotion-css="bjcerb">.css-bjcerb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;list-style:none;padding:0;font-size:14px;min-height:260px;}@media (min-width:780px){.css-bjcerb{-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;font-size:16px;}}@media (min-width:1024px){.css-bjcerb{height:300px;font-size:18px;}}</style><ul class="css-bjcerb e191jpam0"><style data-emotion-css="1c4m9lv">.css-1c4m9lv{width:100%;text-align:center;min-height:100%;background:black;background-size:cover;}.css-1c4m9lv a{-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;background:rgba(0,0,0,0.8);height:100%;-webkit-transition:background 0.5s ease;transition:background 0.5s ease;padding:1em;}.css-1c4m9lv a:hover{background:rgba(0,0,0,0.3);}.css-1c4m9lv a h4{color:#fff;font-size:1.2em;}.css-1c4m9lv a p{color:rgba(255,255,255,0.8);font-size:0.8em;vertical-align:middle;line-height:1em;}.css-1c4m9lv a p svg{vertical-align:text-bottom;}</style><li style="background-image:url(/static/ea5bb4fdb59eb7d14eb0a6b5a7e64465/my-serverless-talk-at-shift-conference-in-split-cover-picture.jpg)" class="css-1c4m9lv e191jpam1"><a rel="prev" href="/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/my-serverless-talk-at-shift-conference-in-split"><style data-emotion-css="1mhqlqt">.css-1mhqlqt{display:inline-block;padding:4px 10px 5px;text-transform:uppercase;font-size:0.8em;color:rgba(255,255,255,0.8);}</style><span class="css-1mhqlqt e191jpam2">Read this next</span><h4>My Serverless talk at Shift conference in Split</h4><p><svg aria-hidden="true" data-prefix="far" data-icon="eye" class="svg-inline--fa fa-eye fa-w-18" viewBox="0 0 576 512" width="1em" height="1em"><path fill="currentColor" d="M569.354 231.631C512.97 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-102.556 0-192.091-54.701-240-136 44.157-74.933 123.677-127.27 216.162-135.007C273.958 131.078 280 144.83 280 160c0 30.928-25.072 56-56 56s-56-25.072-56-56l.001-.042C157.794 179.043 152 200.844 152 224c0 75.111 60.889 136 136 136s136-60.889 136-136c0-31.031-10.4-59.629-27.895-82.515C451.704 164.638 498.009 205.106 528 256c-47.908 81.299-137.444 136-240 136z"></path></svg> <!-- -->2<!-- --> minutes read</p></a></li><li style="background-image:url(/static/917e1c27c76ede42e7c2693844bd6898/from-bare-metal-to-serverless-luciano-mammino-loige-co.jpg)" class="css-1c4m9lv e191jpam1"><a rel="next" href="/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/from-bare-metal-to-serverless"><span class="css-1mhqlqt e191jpam2">You might enjoy</span><h4>From bare metal to Serverless</h4><p><svg aria-hidden="true" data-prefix="far" data-icon="eye" class="svg-inline--fa fa-eye fa-w-18" viewBox="0 0 576 512" width="1em" height="1em"><path fill="currentColor" d="M569.354 231.631C512.97 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-102.556 0-192.091-54.701-240-136 44.157-74.933 123.677-127.27 216.162-135.007C273.958 131.078 280 144.83 280 160c0 30.928-25.072 56-56 56s-56-25.072-56-56l.001-.042C157.794 179.043 152 200.844 152 224c0 75.111 60.889 136 136 136s136-60.889 136-136c0-31.031-10.4-59.629-27.895-82.515C451.704 164.638 498.009 205.106 528 256c-47.908 81.299-137.444 136-240 136z"></path></svg> <!-- -->12<!-- --> minutes read</p></a></li></ul><style data-emotion-css="cyh6ia">.css-cyh6ia{background-color:#20232a;color:#ffffff;padding-top:30px;padding-bottom:50px;position:relative;}</style><footer class="css-cyh6ia ecf9mth0"><style data-emotion-css="106yi9a">.css-106yi9a{position:absolute;width:100%;top:0;height:2px;display:block;-webkit-transform-origin:left center 0px;-ms-transform-origin:left center 0px;transform-origin:left center 0px;-webkit-transform:scaleX(1);-ms-transform:scaleX(1);transform:scaleX(1);z-index:50;-webkit-transition:-webkit-transform 400ms ease 100ms;-webkit-transition:transform 400ms ease 100ms;transition:transform 400ms ease 100ms;background:linear-gradient(90deg,#46c9e5,#d26ac2);}</style><span class="css-106yi9a ecf9mth1"></span><style data-emotion-css="uw949j">.css-uw949j{padding-left:20px;padding-right:20px;max-width:1260px;margin-left:auto;margin-right:auto;}@media (min-width:780px){.css-uw949j{width:90%;}}</style><div class="css-uw949j ecf9mth2"><style data-emotion-css="1sqxil1">.css-1sqxil1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-1sqxil1 ecf9mth3"><style data-emotion-css="102txan">.css-102txan{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;margin-bottom:1em;padding-right:1em;width:100%;}@media (min-width:780px){.css-102txan{width:auto;}}</style><div class="css-102txan ecf9mth5"><style data-emotion-css="ft5n8x">.css-ft5n8x{color:#d26ac2;font-size:14px;font-weight:bold;line-height:3;text-transform:uppercase;-webkit-letter-spacing:0.08em;-moz-letter-spacing:0.08em;-ms-letter-spacing:0.08em;letter-spacing:0.08em;}</style><div style="color:#46c9e5" class="css-ft5n8x ecf9mth7">Loige.co</div><style data-emotion-css="15vbtor">.css-15vbtor{font-size:0.8em;padding:4px 0 0 0;color:#ccc;}.css-15vbtor a{color:inherit;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;}.css-15vbtor a:hover{color:#46c9e5;-webkit-text-decoration:underline;text-decoration:underline;}</style><p class="css-15vbtor ecf9mth9">Copyright © Luciano Mammino 2014-<!-- -->2020<!-- -->.</p><p class="css-15vbtor ecf9mth9">Built with<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://www.gatsbyjs.org">Gatsby</a>, Coffee and a lot of <style data-emotion-css="12awzcx">.css-12awzcx{color:#d26ac2;}.css-12awzcx:hover{color:red;}</style><span class="css-12awzcx ecf9mth10">❤︎</span>.</p><p class="css-15vbtor ecf9mth9">Loige logo designed by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="http://andreamangano.com">Andrea Mangano</a>.</p><p class="css-15vbtor ecf9mth9">Hosted on<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://github.com/lmammino/loige.co">GitHub</a>, accelerated by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://www.cloudflare.com">Cloudflare</a>.</p><p class="css-15vbtor ecf9mth9">Theme inspired by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://reactjs.org/docs/">React documentation.</a></p><p class="css-15vbtor ecf9mth9">Icons by<!-- --> <a rel="nofollow noopener noreferrer" target="_blank" href="https://fontawesome.com/">Font Awesome</a>.</p></div><style data-emotion-css="11r2esw">.css-11r2esw{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;margin-bottom:1em;padding-right:1em;}</style><div class="css-11r2esw ecf9mth4"><style data-emotion-css="5h0m38">.css-5h0m38{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="css-5h0m38 ecf9mth6"><div class="css-ft5n8x ecf9mth7">Explore</div><style data-emotion-css="1ez8siy">.css-1ez8siy{color:inherit;line-height:2;-webkit-text-decoration:none;text-decoration:none;}.css-1ez8siy:hover{color:#46c9e5;}</style><a href="/" class="css-1ez8siy ecf9mth8">Blog</a><a href="/speaking" class="css-1ez8siy ecf9mth8">Speaking</a><a href="/about" class="css-1ez8siy ecf9mth8">About</a><a href="/comment-policy" class="css-1ez8siy ecf9mth8">Comment Policy</a></div></div><div class="css-11r2esw ecf9mth4"><div class="css-5h0m38 ecf9mth6"><div class="css-ft5n8x ecf9mth7">My Projects</div><a target="_blank" rel="nofollow noopener noreferrer" href="https://www.nodejsdesignpatterns.com" class="css-1ez8siy ecf9mth8">Node.js Design Patterns</a><a target="_blank" rel="nofollow noopener noreferrer" href="https://serverlesslab.com" class="css-1ez8siy ecf9mth8">ServerlessLab</a><a target="_blank" rel="nofollow noopener noreferrer" href="https://fullstackbulletin.com" class="css-1ez8siy ecf9mth8">FullStack Bulletin</a><a target="_blank" rel="nofollow noopener noreferrer" href="https://middy.js.org" class="css-1ez8siy ecf9mth8">Middy</a></div></div><div class="css-11r2esw ecf9mth4"><div class="css-5h0m38 ecf9mth6"><div class="css-ft5n8x ecf9mth7">Follow me</div><a rel="nofollow noopener noreferrer" href="https://twitter.com/loige" class="css-1ez8siy ecf9mth8"><svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg> Twitter</a><a rel="nofollow noopener noreferrer" href="https://github.com/lmammino" class="css-1ez8siy ecf9mth8"><svg aria-label="GitHub" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg> GitHub</a><a rel="nofollow noopener noreferrer" href="https://www.linkedin.com/in/lucianomammino" class="css-1ez8siy ecf9mth8"><svg aria-label="LinkedIn" viewBox="0 0 24 24" width="1em" height="1em"><path fill="currentColor" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg> Linkedin</a></div></div></div></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-47248506-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/using-lets-encrypt-and-certbot-to-automate-the-creation-of-certificates-for-openvpn/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-7950fa55a2f571e8796e.js"],"app":["/app-fd3bb3cd76573cd1684d.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-16703ee5599528db9f93.js"],"component---content-pages-about-js":["/component---content-pages-about-js-961e8209f9375177e0e1.js"],"component---content-pages-comment-policy-js":["/component---content-pages-comment-policy-js-4ab458491d6303a44dbe.js"],"component---src-pages-404-js":["/component---src-pages-404-js-852e8f4ad4a19492ebb7.js"],"component---src-templates-blog-index-js":["/component---src-templates-blog-index-js-153abae3637d276aa24c.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-78dda0257c60046d6431.js"],"component---src-templates-blog-post-share-image-js":["/component---src-templates-blog-post-share-image-js-7f777aad80576b54f824.js"],"component---src-templates-speaking-index-js":["/component---src-templates-speaking-index-js-3cd77da67e547d28db93.js"],"component---src-templates-tag-index-js":["/component---src-templates-tag-index-js-8231f2157048061162c6.js"]};/*]]>*/</script><script src="/polyfill-7950fa55a2f571e8796e.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-78dda0257c60046d6431.js" async=""></script><script src="/850935577dc6138b95e5bc3f6f1d9b06bd36398e-76830da6586781bb274a.js" async=""></script><script src="/app-fd3bb3cd76573cd1684d.js" async=""></script><script src="/framework-81279cacaab4bdba7685.js" async=""></script><script src="/webpack-runtime-9add3bd124e56b1a6ff9.js" async=""></script></body></html>